# SETUP ‚Äî Laravel Boilerplate (PHP-FPM + Nginx TCP + External PostgreSQL/MySQL + External Redis Cluster)

–≠—Ç–æ—Ç boilerplate –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ Laravel-–ø—Ä–æ–µ–∫—Ç–∞ –≤ Docker Compose, –≥–¥–µ:
- **–≤–Ω—É—Ç—Ä–∏ Compose –∂–∏–≤—É—Ç —Ç–æ–ª—å–∫–æ app-—Å–µ—Ä–≤–∏—Å—ã** (PHP-FPM + Nginx + Node/Vite –≤ dev);
- **PHP-FPM –∏ Nginx –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç –ø–æ TCP** (–ø–æ—Ä—Ç 9000);
- **PostgreSQL/MySQL ‚Äî –≤–Ω–µ—à–Ω–∏–π** (managed DB –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä/–∫–ª–∞—Å—Ç–µ—Ä);
- **Redis Cluster ‚Äî –≤–Ω–µ—à–Ω–∏–π** (managed Redis Cluster –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä);
- –º–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è **one-off** —Å–µ—Ä–≤–∏—Å–æ–º `migrate` (prod-like –ø–æ–¥—Ö–æ–¥).

---

## 0) –ü—Ä–µ–¥–ø–æ—Å—ã–ª–∫–∏ (—á—Ç–æ –Ω—É–∂–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ)

### –ù–∞ –º–∞—à–∏–Ω–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
- Docker + Docker Compose (plugin)
- Make (–æ–±—ã—á–Ω–æ –µ—Å—Ç—å –Ω–∞ macOS)
- –î–æ—Å—Ç—É–ø –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º:
    - PostgreSQL –∏–ª–∏ MySQL: `host:port`, –±–∞–∑–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø–∞—Ä–æ–ª—å
    - Redis Cluster: —Å–ø–∏—Å–æ–∫ –Ω–æ–¥ `host:port,host:port,...`, –ø–∞—Ä–æ–ª—å/ACL (–µ—Å–ª–∏ –µ—Å—Ç—å), TLS (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

---

## 1) –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å boilerplate –≤ –Ω–æ–≤–æ–º Laravel-–ø—Ä–æ–µ–∫—Ç–µ

### –í–∞—Ä–∏–∞–Ω—Ç A (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è): —Å–æ–∑–¥–∞—ë—Ç–µ –Ω–æ–≤—ã–π Laravel –∏ –∫–æ–ø–∏—Ä—É–µ—Ç–µ boilerplate
1) –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç Laravel:
```
bash
composer create-project laravel/laravel .
```
2) –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ —ç—Ç–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ –∫–æ—Ä–µ–Ω—å –≤–∞—à–µ–≥–æ Laravel-–ø—Ä–æ–µ–∫—Ç–∞:
- –ø–∞–ø–∫—É `docker/`
- `docker-compose.yml`
- `docker-compose.dev.yml`
- `docker-compose.prod.yml`
- `Makefile`
- `.env.docker` (–∫–∞–∫ –ø–æ–¥—Å–∫–∞–∑–∫–∏/–∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö)

3) –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –∫–æ—Ä–Ω–µ –µ—Å—Ç—å `.env` (Laravel —Å–æ–∑–¥–∞—ë—Ç –µ–≥–æ —Å–∞–º).

---

## 2) –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `.env` (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ)

> –í–∞–∂–Ω–æ: –≤ external-–º–æ–¥–µ–ª–∏ **–Ω–µ—Ç** –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –ë–î/Redis –≤–Ω—É—Ç—Ä–∏ Compose, –ø–æ—ç—Ç–æ–º—É `DB_HOST` –∏ Redis-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã **–¥–æ–ª–∂–Ω—ã —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ endpoints**.

### 2.1 –í—ã–±–æ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (PostgreSQL / MySQL) –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ Dockerfile

–í —ç—Ç–æ–º boilerplate –µ—Å—Ç—å –¥–≤–∞ Dockerfile –¥–ª—è PHP:

- `docker/php.pgsql.Dockerfile` ‚Äî PHP —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ `pdo_pgsql/pgsql`
- `docker/php.mysql.Dockerfile` ‚Äî PHP —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ `pdo_mysql/mysqli`

–ß—Ç–æ–±—ã –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è, –≤ `docker-compose.yml` —É —Å–µ—Ä–≤–∏—Å–∞ `laravel-php-nginx-tcp` –ø–æ–º–µ–Ω—è–π—Ç–µ `build.dockerfile`:

```yml
services:
  laravel-php-nginx-tcp:
    build:
      context: ./docker
      dockerfile: php.pgsql.Dockerfile # –∏–ª–∏ php.mysql.Dockerfile
      target: php-base
```

–¢–∞–∫–∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π—Ç–µ `.env` Laravel:

- –¥–ª—è PostgreSQL: `DB_CONNECTION=pgsql`, `DB_PORT=5432`
- –¥–ª—è MySQL: `DB_CONNECTION=mysql`, `DB_PORT=3306`

–ï—Å–ª–∏ –ë–î –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ Docker (–≤ –¥—Ä—É–≥–æ–º compose-–ø—Ä–æ–µ–∫—Ç–µ), app-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ç–æ–π –∂–µ —Å–µ—Ç–∏. –í —à–∞–±–ª–æ–Ω–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ `docker-compose.yml` –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –≤–Ω–µ—à–Ω—è—è —Å–µ—Ç—å `postgres-dev-network` ‚Äî –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ MySQL –æ–±—ã—á–Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–º–µ–Ω–∏—Ç—å –µ—ë –Ω–∞ –≤–∞—à—É MySQL-—Å–µ—Ç—å (–∏–ª–∏ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç network, –µ—Å–ª–∏ –≤—ã —Ö–æ–¥–∏—Ç–µ –≤ managed DB/–Ω–∞—Ä—É–∂—É Docker).

### 2.2 PostgreSQL (external)

–í external-–º–æ–¥–µ–ª–∏ (–≤–Ω–µ—à–Ω—è—è –ë–î) Laravel **–Ω–µ —Å–æ–∑–¥–∞—ë—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ö–æ–º–∞–Ω–¥–∞ `php artisan migrate` —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—ã, –Ω–æ –Ω–µ –¥–µ–ª–∞–µ—Ç `CREATE DATABASE`.

–ë–∞–∑—É –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∑–∞—Ä–∞–Ω–µ–µ –≤—Ä—É—á–Ω—É—é (—á–µ—Ä–µ–∑ SQL –∏–ª–∏ –∞–¥–º–∏–Ω–∫—É). –£ –∫–∞–∂–¥–æ–π –±–∞–∑—ã —Å–≤–æ—è —Å—Ö–µ–º–∞ `public`.

#### 1) –®–∞–±–ª–æ–Ω: ‚Äú1 –ø—Ä–æ–µ–∫—Ç = 1 –±–∞–∑–∞ + 1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å‚Äù

–ü—Ä–∏–º–µ—Ä –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ `app1`:
- –±–∞–∑–∞: `app1_db`
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `app1_user`
- –ø–∞—Ä–æ–ª—å: `<PASSWORD_PLACEHOLDER>`

**–°–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ SQL (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º** (–æ–±—ã—á–Ω–æ `postgres`) —á–µ—Ä–µ–∑ psql/pgAdmin/DataGrip.
2. **–°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:
   ```sql
   CREATE ROLE app1_user WITH LOGIN PASSWORD '<PASSWORD_PLACEHOLDER>';
   ```
3. **–°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É** –∏ –Ω–∞–∑–Ω–∞—á—å—Ç–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞:
   ```sql
   CREATE DATABASE app1_db OWNER app1_user;
   ```
4. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
   ```sql
   REVOKE ALL ON DATABASE app1_db FROM PUBLIC;
   GRANT CONNECT ON DATABASE app1_db TO app1_user;
   ```

#### 2) –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `.env`

–í –≤–∞—à–µ–º `.env` —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
```dotenv
DB_CONNECTION=pgsql
DB_HOST=<postgres_service_or_container_name>
DB_PORT=5432
DB_DATABASE=app1_db
DB_USERNAME=app1_user
DB_PASSWORD=<PASSWORD_PLACEHOLDER>
```

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–±—Ä–æ—Å—å—Ç–µ –∫—ç—à –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
php artisan config:clear
php artisan cache:clear
```

–î–∞–ª—å—à–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
```bash
php artisan migrate
```

#### üß∞ –ï—Å–ª–∏ –≤ PhpStorm/DataGrip ‚Äú–º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—à–ª–∏, –∞ —Ç–∞–±–ª–∏—Ü –Ω–µ –≤–∏–¥–Ω–æ‚Äù
–≠—Ç–æ —á–∞—Å—Ç–æ –Ω–µ –±–∞–≥, –∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.
1. Database tool window ‚Üí –≤–∞—à datasource ‚Üí –±–∞–∑–∞ `app1_db`.
2. –û—Ç–∫—Ä–æ–π—Ç–µ **Schemas‚Ä¶** (–∏–ª–∏ Properties ‚Üí Schemas).
3. –û—Ç–º–µ—Ç—å—Ç–µ —Å—Ö–µ–º—É **`public`**.
4. –ù–∞–∂–º–∏—Ç–µ **Apply / OK** –∏ —Å–¥–µ–ª–∞–π—Ç–µ **Refresh**.

#### TLS –¥–ª—è Postgres (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞/–¥—Ä–∞–π–≤–µ—Ä–∞ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è `DB_SSLMODE`.
–ï—Å–ª–∏ –≤–∞—à–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç—Ä–µ–±—É–µ—Ç TLS, –¥–æ–±–∞–≤—å—Ç–µ (–ø—Ä–∏–º–µ—Ä):
```
dotenv
DB_SSLMODE=require
```

### 2.3 MySQL (external)

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ PostgreSQL: –≤ external-–º–æ–¥–µ–ª–∏ Laravel **–Ω–µ —Å–æ–∑–¥–∞—ë—Ç** –±–∞–∑—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî –µ—ë –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∑–∞—Ä–∞–Ω–µ–µ.

#### 1) –®–∞–±–ª–æ–Ω: ‚Äú1 –ø—Ä–æ–µ–∫—Ç = 1 –±–∞–∑–∞ + 1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å‚Äù

–ü—Ä–∏–º–µ—Ä –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ `app1`:
- –±–∞–∑–∞: `app1_db`
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `app1_user`
- –ø–∞—Ä–æ–ª—å: `<PASSWORD_PLACEHOLDER>`

**–°–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ SQL (–ø—Ä–∏–º–µ—Ä):**

```sql
CREATE DATABASE app1_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'app1_user'@'%' IDENTIFIED BY '<PASSWORD_PLACEHOLDER>';
GRANT ALL PRIVILEGES ON app1_db.* TO 'app1_user'@'%';
FLUSH PRIVILEGES;
```

#### 2) –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `.env`

–í –≤–∞—à–µ–º `.env` —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:

```dotenv
DB_CONNECTION=mysql
DB_HOST=<mysql_service_or_host>
DB_PORT=3306
DB_DATABASE=app1_db
DB_USERNAME=app1_user
DB_PASSWORD=<PASSWORD_PLACEHOLDER>
```

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–±—Ä–æ—Å—å—Ç–µ –∫—ç—à –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```bash
php artisan config:clear
php artisan cache:clear
```

–î–∞–ª—å—à–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
php artisan migrate
```
---

### 2.4 Redis Cluster (external)
–≠—Ç–æ—Ç boilerplate –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Redis):
```
dotenv
REDIS_CLIENT=phpredis
REDIS_CLUSTER=redis
REDIS_CLUSTER_NODES=<host1>:<port1>,<host2>:<port2>,<host3>:<port3>
REDIS_PASSWORD=<redis_password_or_empty>
REDIS_TLS=false
```
–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
- `REDIS_CLUSTER_NODES` ‚Äî CSV —Å—Ç—Ä–æ–∫–∞ –Ω–æ–¥ –∫–ª–∞—Å—Ç–µ—Ä–∞.
- `REDIS_PASSWORD` ‚Äî –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ –Ω—É–∂–µ–Ω.
- `REDIS_TLS` ‚Äî `true`, –µ—Å–ª–∏ –≤–∞—à managed Redis Cluster —Ç—Ä–µ–±—É–µ—Ç TLS.

---

### 2.5 Docker/dev-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
–í dev –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ—Ä—Ç–∞ Nginx –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ Xdebug.

–í—ã –º–æ–∂–µ—Ç–µ:
- –ª–∏–±–æ **–¥–æ–±–∞–≤–∏—Ç—å** –Ω—É–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`,
- –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.env.docker` –∫–∞–∫ ‚Äú—à–ø–∞—Ä–≥–∞–ª–∫—É‚Äù.

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –¥–ª—è dev:
```
dotenv
NGINX_PORT=80

XDEBUG_MODE=off
XDEBUG_START=no
XDEBUG_CLIENT_HOST=host.docker.internal
```
---

## 3) –ó–∞–ø—É—Å–∫ DEV –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 3.1 –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
```
bash
make setup
```
–ß—Ç–æ –¥–µ–ª–∞–µ—Ç `make setup` (–ª–æ–≥–∏–∫–∞ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è, –µ—Å–ª–∏ –≤—ã –µ—ë –º–µ–Ω—è–ª–∏):
- —Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤
- –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (composer + npm)
- –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –∑–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
- —Ñ–∏–∫—Å–∞—Ü–∏—è –ø—Ä–∞–≤ –Ω–∞ `storage/` –∏ `bootstrap/cache`

### 3.2 –û–±—ã—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
–ü–æ–¥–Ω—è—Ç—å/–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
```
bash
make up
make down
```
–õ–æ–≥–∏:
```
bash
make logs
make logs-php
make logs-nginx
make logs-node
```
–í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
```
bash
make shell-php
make shell-nginx
make shell-node
```
Artisan/Composer:
```
bash
make artisan CMD="about"
make artisan CMD="migrate"
make composer CMD="install"
```
–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
- http://localhost (–∏–ª–∏ –ø–æ—Ä—Ç –∏–∑ `NGINX_PORT`)

---

## 4) –ó–∞–ø—É—Å–∫ PROD-like (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)

> –í production overlay –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–≥–æ—Ç–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã –∏–∑ Registry** (`docker-compose.prod.yml`).

–ü–æ–¥–Ω—è—Ç—å –ø—Ä–æ–¥-—Å—Ç–µ–∫:
```
bash
make up-prod
```
–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ one-off:
```
bash
docker compose -f docker-compose.yml -f docker-compose.prod.yml run --rm migrate
```
---

## 5) –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `migrate` –≤ external-–º–æ–¥–µ–ª–∏

–°–µ—Ä–≤–∏—Å `migrate`:
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ PHP-–æ–±—Ä–∞–∑, —á—Ç–æ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ;
- –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ **–≤–Ω–µ—à–Ω–µ–π** PostgreSQL —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `.env`;
- –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
```
bash
php artisan migrate --force
```
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è CI/CD:
- –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ** (–Ω–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –¥–µ–ø–ª–æ—è–º–∏)
- –ø–æ—Ä—è–¥–æ–∫ –æ–±—ã—á–Ω–æ —Ç–∞–∫–æ–π:
    1) pull –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–∑–æ–≤
    2) `up -d` –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    3) `run --rm migrate`

---

## 6) –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –±—ã—Å—Ç—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### 6.1 –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ –ë–î
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- `DB_HOST/DB_PORT` –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (—Å–µ—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø/—Ñ–∞–µ—Ä–≤–æ–ª/VPC).
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω—ã (—Å–º. —Ä–∞–∑–¥–µ–ª 2.1).
- –ö—Ä–µ–¥—ã –≤–µ—Ä–Ω—ã–µ (`DB_DATABASE/DB_USERNAME/DB_PASSWORD`).
- `DB_CONNECTION=pgsql`.

### 6.2 –í PhpStorm/DataGrip –Ω–µ –≤–∏–¥–Ω–æ —Ç–∞–±–ª–∏—Ü
–ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ, –Ω–æ –≤ IDE –¥–µ—Ä–µ–≤–æ —Ç–∞–±–ª–∏—Ü –ø—É—Å—Ç–æ–µ:
1. –í –æ–∫–Ω–µ Database –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à datasource ‚Üí –±–∞–∑–∞ `app1_db`.
2. –û—Ç–∫—Ä–æ–π—Ç–µ **Schemas‚Ä¶** (–∏–ª–∏ Properties ‚Üí Schemas).
3. –û—Ç–º–µ—Ç—å—Ç–µ —Å—Ö–µ–º—É **`public`**.
4. –ù–∞–∂–º–∏—Ç–µ **Apply / OK** –∏ —Å–¥–µ–ª–∞–π—Ç–µ **Refresh**.

### 6.3 Redis Cluster ‚Äú–Ω–µ –≤–∏–¥–µ–Ω‚Äù –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç—ã
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- `REDIS_CLUSTER_NODES` –≤ —Ñ–æ—Ä–º–∞—Ç–µ `host:port,host:port,...` –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤
- `REDIS_TLS=true`, –µ—Å–ª–∏ –≤–∞—à –∫–ª–∞—Å—Ç–µ—Ä —Ç—Ä–µ–±—É–µ—Ç TLS
- –ø–∞—Ä–æ–ª—å/ACL (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã)

### 6.4 –í dev –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–∞–π—Ç
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- `NGINX_PORT` –Ω–µ –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º
- –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Å—Ç–∞—Ç—É—Å–µ `healthy`:
```
bash
make status
```
---

## 7) –ß—Ç–æ —ç—Ç–æ—Ç boilerplate *–Ω–µ –¥–µ–ª–∞–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ*
- –ù–µ –ø–æ–¥–Ω–∏–º–∞–µ—Ç Postgres/Redis/pgAdmin –≤–Ω—É—Ç—Ä–∏ Docker Compose (—ç—Ç–æ ‚Äúexternal infra‚Äù –≤–µ—Ä—Å–∏—è).
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç —Å–µ–∫—Ä–µ—Ç—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏: –ø–∞—Ä–æ–ª–∏/–∫–ª—é—á–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∏–∑ `.env` (dev) –∏–ª–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤ CI/CD (prod).

---

## 8) –ú–∏–Ω–∏-—á–µ–∫–ª–∏—Å—Ç ‚Äú–≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ‚Äù
- [ ] `docker compose ...` –ø–æ–¥–Ω–∏–º–∞–µ—Ç `php` + `nginx` (+ `node` –≤ dev)
- [ ] `.env` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞–ª–∏–¥–Ω—ã–µ `DB_*` –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ Postgres
- [ ] (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) `.env` —Å–æ–¥–µ—Ä–∂–∏—Ç `REDIS_*` –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ Redis Cluster
- [ ] `make setup` –ø—Ä–æ—Ö–æ–¥–∏—Ç –∏ `php artisan migrate` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- [ ] —Å–∞–π—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `http://localhost` (–∏–ª–∏ –≤–∞—à–µ–º –ø–æ—Ä—Ç—É)

---

